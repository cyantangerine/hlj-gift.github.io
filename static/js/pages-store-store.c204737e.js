(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-store-store"],{"09e9":function(t,n,e){"use strict";e.r(n);var o=e("e67c"),i=e.n(o);for(var a in o)["default"].indexOf(a)<0&&function(t){e.d(n,t,(function(){return o[t]}))}(a);n["default"]=i.a},6743:function(t,n,e){"use strict";e.d(n,"b",(function(){return o})),e.d(n,"c",(function(){return i})),e.d(n,"a",(function(){}));var o=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("v-uni-view",[t.login?e("v-uni-view",{staticStyle:{width:"700rpx","margin-left":"25rpx"}},[e("v-uni-button",{staticStyle:{"margin-top":"20rpx"},on:{click:function(n){arguments[0]=n=t.$handleEvent(n),t.logincheck.apply(void 0,arguments)}}},[t._v("刷新")]),e("v-uni-button",{staticStyle:{"margin-top":"20rpx"},on:{click:function(n){arguments[0]=n=t.$handleEvent(n),t.deltikscan.apply(void 0,arguments)}}},[t._v("券码核销")]),e("v-uni-view",[t._v("券码每日21点过期")]),e("v-uni-view",[t._v("今日中奖用户手机号 中奖批次 奖品")]),t._l(t.users,(function(n,o){return e("v-uni-view",{staticStyle:{display:"flex","justify-content":"space-between"}},[e("v-uni-button",{staticStyle:{"font-size":"20rpx",padding:"0",width:"80rpx"},attrs:{disabled:"未发放"==n.id||n.checked},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.deltik(n,o)}}},[t._v(t._s(n.checked?"已销":"核销"))]),e("v-uni-view",{staticStyle:{width:"40%"}},[t._v(t._s(n.id))]),e("v-uni-view",{staticStyle:{width:"30%"}},[t._v(t._s(n.time))]),e("v-uni-view",{staticStyle:{width:"30%"}},[t._v(t._s(n.reward))])],1)})),e("v-uni-view",{staticStyle:{height:"250rpx"}})],2):e("v-uni-view",{staticStyle:{padding:"30rpx"}},[e("v-uni-input",{attrs:{placeholder:"商户名称"},model:{value:t.account,callback:function(n){t.account=n},expression:"account"}}),e("v-uni-input",{staticStyle:{"margin-top":"20rpx"},attrs:{password:!0,placeholder:"商户密码"},model:{value:t.password,callback:function(n){t.password=n},expression:"password"}}),e("v-uni-view",{staticStyle:{display:"flex","justify-content":"flex-start","align-items":"center","font-size":"25rpx","margin-top":"20rpx"}},[e("v-uni-icon",{attrs:{type:t.autologin?"success":"circle"},on:{click:function(n){arguments[0]=n=t.$handleEvent(n),t.setauto.apply(void 0,arguments)}}}),e("v-uni-view",{staticStyle:{"margin-left":"10rpx"}},[t._v("记住密码")])],1),e("v-uni-button",{staticStyle:{"margin-top":"20rpx"},on:{click:function(n){arguments[0]=n=t.$handleEvent(n),t.logincheck.apply(void 0,arguments)}}},[t._v("登录")])],1)],1)},i=[]},"8b08":function(t,n,e){"use strict";e.r(n);var o=e("6743"),i=e("09e9");for(var a in i)["default"].indexOf(a)<0&&function(t){e.d(n,t,(function(){return i[t]}))}(a);var c=e("828b"),r=Object(c["a"])(i["default"],o["b"],o["c"],!1,null,"aa56f0ce",null,!1,o["a"],void 0);n["default"]=r.exports},e67c:function(t,n,e){"use strict";(function(t){e("6a54");var o=e("f5bd").default;Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=o(e("39d8"));e("5ef2"),e("64aa"),e("dc8a"),e("aa9c"),e("5c47"),e("2c10"),e("23f4"),e("7d2f"),e("9c4e"),e("ab80");var a=getApp(),c=t.database(),r=a.globalData,s=e("235a"),u=e("7033").cbq,l=e("70b4"),d=null,f={data:function(){return{login:!1,account:"",password:"",autologin:!1,info:r.info,users:[]}},onLoad:function(){d=this;var t=uni.getStorageSync("STOREKEY");t&&t.account&&(d.account=t.account,t.password&&(d.password=t.password,d.autologin=!0))},methods:{checkdate:function(){return!((new Date).getHours()>21)||(uni.showToast({title:"已过期",icon:"error"}),!1)},deltikfromcode:function(t){var n={content:t},e=n.content.indexOf("T"),o=n.content.indexOf("BLK");if(-1==e||-1==o)return d.ticket_temp=n.content,uni.showToast({title:"券码无效",icon:"error"});var a=n.content.substring(e),r=Number(a.substring(1));if(console.log(r),l.formatDateToString(new Date(r)).split(" ")[0]!=l.formatDateToString(new Date).split(" ")[0])return console.log(l.formatDateToString(new Date(r)).split(" ")[0],l.formatDateToString(new Date).split(" ")[0]),uni.showToast({title:"券码已过期",icon:"error"});var s=n.content.substring(0,o),f=n.content.substring(o+3,e);uni.showLoading({mask:!0}),u(c.collection("Gdata").doc(a).get(),{success:function(t){if(uni.hideLoading(),t.data[0]){var n=t.data[0].successIndex[f];if(console.log(t.data[0].users[n]),t.data[0].users[n]==s){if(t.data[0].checked&&t.data[0].checked["m"+s])return void uni.showToast({title:"券码已被使用",icon:"error"});var e=d.prepareData(),o=d.info.reward[t.data[0].group][f];return-1==e.indexOf(o)?void uni.showToast({title:"券码无效",icon:"error"}):void uni.showModal({title:"确认核销？",content:"手机号："+s+"\n奖品："+o,success:function(t){t.confirm&&(d.ticket_temp="",uni.showLoading({mask:!0}),c.collection("Gdata").doc(a).update({checked:(0,i.default)({},"m"+s,l.formatDateToString(new Date))}).then((function(t){console.log(t);t=t.result;t.updated?(uni.showToast({title:"成功"}),d.logincheck()):uni.showToast({title:"券码不存在",icon:"error"}),setTimeout((function(){uni.hideLoading(),d.loading=!1}),1e3)})).catch((function(t){console.error(t),setTimeout((function(){uni.hideLoading(),d.loading=!1,uni.showToast({title:"网络繁忙",icon:"error"})}),1e3)})))}})}}return uni.showToast({title:"券码无效",icon:"error"})},fail:function(t){return uni.showToast({title:"券码无效",icon:"error"})}})},deltikscan:function(){d.checkdate()&&uni.showModal({title:"请扫描后复制券码，填入框中",editable:!0,content:d.ticket_temp,fail:function(){uni.hideLoading(),uni.showToast({title:"网络繁忙",icon:"error"})},success:function(t){t.confirm&&t.content&&d.deltikfromcode(t.content)}})},prepareData:function(){var t=Object.keys(d.info.location),n=[],e=d.info.location;for(var o in t){var i=t[o],a=e[i];a==d.account&&n.push(i)}return console.log("奖品名称",n),n},setauto:function(t){console.log(t),d.autologin=!d.autologin},deltik:function(t,n){d.checkdate()&&uni.showModal({title:"确认核销？",content:"手机号："+t.id+"\n奖品："+t.reward,success:function(e){if(e.confirm){var o=t._id;uni.showLoading({mask:!0}),c.collection("Gdata").doc(o).update({checked:(0,i.default)({},"m"+t.id,l.formatDateToString(new Date))}).then((function(t){console.log(t);t=t.result;t.updated?(uni.showToast({title:"成功"}),d.users[n].checked=!0):uni.showToast({title:"券码不存在",icon:"error"}),setTimeout((function(){uni.hideLoading(),d.loading=!1}),1e3)})).catch((function(t){console.error(t),setTimeout((function(){uni.hideLoading(),d.loading=!1,uni.showToast({title:"网络繁忙",icon:"fail"})}),1e3)}))}}})},logincheck:function(){if(d.info.stores[d.account]){console.log(d.info.stores[d.account]);var t=s.aes.en(d.account,"ilovehlj");if(console.log(t),t.substring(0,10)==d.password){uni.setStorage({key:"STOREKEY",data:{account:d.account,password:d.autologin?d.password:""}}),d.login=!0,d.users=[];var n=l.formatDateToString(new Date).split(" ")[0];console.log(n);c.command.aggregate;return void u(c.collection("Gdata").aggregate().match({group:new RegExp(n+".*","i")}).end(),{success:function(t){console.log(t);var n=[],e=d.prepareData();for(var o in t.data){var i=t.data[o];console.log(i.group);var a=d.info.reward[i.group];if(a){console.log(a);var c=[];for(var r in a)-1!=e.indexOf(a[r])&&c.push([r,a[r]]);for(var r in c){var s=c[r],u=i.users[i.successIndex[s[0]]];u||(u="未发放"),n.push({_id:i._id,id:u,reward:s[1],time:i.group,checked:!!i.checked&&i.checked["m"+u]})}}}console.log(n),d.users=n}})}}uni.showToast({title:"错误",icon:"error"})}}};n.default=f}).call(this,e("861b")["default"])}}]);